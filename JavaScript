// script.js
let balance = 1000;
let playerScore = 0;
let dealerScore = 0;
let gameOver = false;
let playerCardsArr = [];
let dealerCardsArr = [];

const balanceEl = document.getElementById('balance');
const betInput = document.getElementById('bet');
const playerScoreEl = document.getElementById('playerScore');
const dealerScoreEl = document.getElementById('dealerScore');
const playerCardsDiv = document.getElementById('playerCards');
const dealerCardsDiv = document.getElementById('dealerCards');
const messagesEl = document.getElementById('messages');

const hitBtn = document.getElementById('hitBtn');
const standBtn = document.getElementById('standBtn');
const resetBtn = document.getElementById('resetBtn');

function getCard() {
  let card = Math.floor(Math.random() * 13) + 1;
  if (card > 10) return 10;
  if (card === 1) return 11;
  return card;
}

function addCardToDiv(card, div) {
  let cardEl = document.createElement('div');
  cardEl.classList.add('card');
  cardEl.textContent = card;
  div.appendChild(cardEl);
}

function calculateScore(cards) {
  let score = cards.reduce((a,b) => a+b,0);
  // Aas correctie
  let aces = cards.filter(c => c===11).length;
  while (score > 21 && aces > 0) {
    score -= 10;
    aces--;
  }
  return score;
}

function startGame() {
  gameOver = false;
  playerCardsArr = [];
  dealerCardsArr = [];
  playerCardsDiv.innerHTML = '';
  dealerCardsDiv.innerHTML = '';
  messagesEl.textContent = '';
  playerScore = 0;
  dealerScore = 0;

  let bet = parseInt(betInput.value);
  if (bet > balance) {
    messagesEl.textContent = "Je hebt niet genoeg balans!";
    gameOver = true;
    return;
  }

  // Beginkaarten
  playerCardsArr.push(getCard());
  playerCardsArr.push(getCard());
  dealerCardsArr.push(getCard());

  playerCardsArr.forEach(c => addCardToDiv(c, playerCardsDiv));
  dealerCardsArr.forEach(c => addCardToDiv(c, dealerCardsDiv));

  playerScore = calculateScore(playerCardsArr);
  dealerScore = calculateScore(dealerCardsArr);

  playerScoreEl.textContent = playerScore;
  dealerScoreEl.textContent = dealerScore;

  checkWinner();
}

function checkWinner() {
  if (playerScore === 21) {
    messagesEl.textContent = "Blackjack! Jij wint!";
    balance += parseInt(betInput.value);
    balanceEl.textContent = balance;
    gameOver = true;
  } else if (playerScore > 21) {
    messagesEl.textContent = "Bust! Dealer wint.";
    balance -= parseInt(betInput.value);
    balanceEl.textContent = balance;
    gameOver = true;
  }
}

hitBtn.addEventListener('click', () => {
  if (gameOver) return;
  let card = getCard();
  playerCardsArr.push(card);
  addCardToDiv(card, playerCardsDiv);
  playerScore = calculateScore(playerCardsArr);
  playerScoreEl.textContent = playerScore;
  checkWinner();
});

standBtn.addEventListener('click', () => {
  if (gameOver) return;
  // Dealer speelt automatisch
  while (calculateScore(dealerCardsArr) < 17) {
    let card = getCard();
    dealerCardsArr.push(card);
    addCardToDiv(card, dealerCardsDiv);
  }

  dealerScore = calculateScore(dealerCardsArr);
  dealerScoreEl.textContent = dealerScore;

  let bet = parseInt(betInput.value);

  if (dealerScore > 21 || playerScore > dealerScore) {
    messagesEl.textContent = "Jij wint!";
    balance += bet;
  } else if (dealerScore === playerScore) {
    messagesEl.textContent = "Gelijkspel!";
  } else {
    messagesEl.textContent = "Dealer wint!";
    balance -= bet;
  }

  balanceEl.textContent = balance;
  gameOver = true;
});

resetBtn.addEventListener('click', startGame);

// Start game automatisch
startGame();
